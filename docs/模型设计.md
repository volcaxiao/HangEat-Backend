# 模型设计

## 实体类

- 用户(id，用户名，学号，密码，邮箱，头像，创建时间，最后登录时间，最后登录IP，状态)
- 店铺(id，店铺名，店铺描述，店铺地址，店铺电话，店铺图片，创建时间，更新时间, 创建者)
- 用户帖子(id，用户id，店铺id，评价内容，评价时间，评价星级，推荐菜品，店铺均价，点赞)
  - 帖子评论(id，用户id，帖子id，回复id，评论内容，评论时间，点赞)
- 推荐菜品(id，菜品名，所属店铺)
- 地址(id，经度，纬度，地址名，关联内容，创建时间，更新时间，创建者)
- tag(id，标签名，创建时间，更新时间，创建者)

## 关系

- 关注用户（用户id，被关注用户id，创建时间，更新时间，创建者）
- 消息（用户id，被发消息用户id，消息内容，创建时间，更新时间，创建者）
- 收藏店铺（用户id，店铺id，创建时间，更新时间，创建者）
- 收藏菜品（用户id，菜品id，创建时间，更新时间，创建者）
- 店铺Tag（店铺id，标签id，创建时间，更新时间，创建者）

## 代办

1. [ ] 用户关注
2. [ ] 用户互发消息
3. [ ] 推荐+创建模型：店铺，推荐菜，Tag
4. [ ] 用户帖子和评论实现
5. [ ] 用户收藏店铺和菜品
6. [ ] 评论markdown支持：`npm install markdown-it --save`
7. [ ] 地图api：百度地图api，和前端协商
8. [ ] 首页推荐算法：根据tag和关注来
9. [ ] 用户主页展示权限
10. [ ] tag筛选餐馆的与逻辑

## 问题

- 发消息需要采取其他实现，先不管了

## api文档

### 用户

#### 用户注册 user/signup [post]

#### 用户登录 user/login [post]

#### 用户登出 user/logout [get]

#### 用户注销 user/delete [delete]

#### 用户更新信息 user/update-info [put]

#### 用户更新头像 user/update-avatar [put]

#### 用户更改密码 user/update-password [post]

#### 得到用户信息 user/get-user-info [get]

#### 刷新token user/refresh-token [get]

#### 发送验证码 user/send-captcha [post]

#### 更改邮箱 user/change-email [post]

#### 收藏餐馆 user/collect [post]

#### 取消收藏 user/uncollect [post]

#### 获取收藏的数目 user/get-collections-num [get]

#### 获取收藏的列表 user/get-collections-list [get]

### 餐馆 restaurant/

#### 创建餐馆 create_restaurant [post]

```json
{
    "name": "餐馆名",
    "address": "餐馆地址",
    "phone": "餐馆电话"
}
```

#### 得到餐馆信息 get_restaurant_detail/{id} [get]

#### 更新餐馆信息 update_restaurant/{id} [put]

```json
{
    "name": "餐馆名",
    "description": "餐馆描述",
    "address": "餐馆地址",
    "phone": "餐馆电话"
}
```

#### 上传餐馆图像 update-image/{id} [post]

- Form-data的格式，key是'image'

#### 删除餐馆 delete_restaurant/{id} [delete]

- 删除餐馆时，同时删除餐馆下的所有帖子
- 需要验证用户是否有权限删除

#### 得到餐馆数目 get_restaurant_num [get]

- 可选参数：creator_id

#### 得到餐馆列表 get_restaurant_list?from=&to= [get]

- 可选参数：creator_id

### tag restaurant/

#### 创建或者附加tag refer_tag [post]

```json
{
    "target_id": "目标id",
    "tags": ["tag1", "tag2", "tag3"]
}
```

- 已有tag会附加，没有的会创建

#### 删除tag delete_tag [delete]

```json
{
    "target_id": "目标id",
    "tag_name": "tag_name"
}
```

#### 得到tag数量 get_tag_num [get]

#### 得到tag列表 get_tag_list?from=&to= [get]

#### 得到tag下的餐馆数量 get_restaurant_num_by_tag?tags=&tags=... [get]

#### 得到tag下的餐馆列表 get_restaurant_list_by_tag?from=&to=&tags=&tags=... [get]

### Post

### 首页广场